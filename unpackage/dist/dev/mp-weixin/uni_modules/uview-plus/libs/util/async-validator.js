"use strict";const K=/%[sdj%]/g;let v=function(){};typeof process<"u"&&process.env&&typeof window<"u"&&typeof document<"u"&&(v=function(t,i){typeof console<"u"&&console.warn&&i.every(n=>typeof n=="string")&&console.warn(t,i)});function V(e){if(!e||!e.length)return null;const t={};return e.forEach(i=>{const{field:n}=i;t[n]=t[n]||[],t[n].push(i)}),t}function l(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let n=1;const s=t[0],r=t.length;if(typeof s=="function")return s.apply(null,t.slice(1));if(typeof s=="string"){let f=String(s).replace(K,c=>{if(c==="%%")return"%";if(n>=r)return c;switch(c){case"%s":return String(t[n++]);case"%d":return Number(t[n++]);case"%j":try{return JSON.stringify(t[n++])}catch{return"[Circular]"}break;default:return c}});for(let c=t[n];n<r;c=t[++n])f+=` ${c}`;return f}return s}function W(e){return e==="string"||e==="url"||e==="hex"||e==="email"||e==="pattern"}function h(e,t){return!!(e==null||t==="array"&&Array.isArray(e)&&!e.length||W(t)&&typeof e=="string"&&!e)}function Y(e,t,i){const n=[];let s=0;const r=e.length;function f(c){n.push.apply(n,c),s++,s===r&&i(n)}e.forEach(c=>{t(c,f)})}function J(e,t,i){let n=0;const s=e.length;function r(f){if(f&&f.length){i(f);return}const c=n;n+=1,c<s?t(e[c],r):i([])}r([])}function z(e){const t=[];return Object.keys(e).forEach(i=>{t.push.apply(t,e[i])}),t}function G(e,t,i,n){if(t.first){const p=new Promise((w,A)=>{const O=function(a){return n(a),a.length?A({errors:a,fields:V(a)}):w()},o=z(e);J(o,i,O)});return p.catch(w=>w),p}let s=t.firstFields||[];s===!0&&(s=Object.keys(e));const r=Object.keys(e),f=r.length;let c=0;const q=[],m=new Promise((p,w)=>{const A=function(o){if(q.push.apply(q,o),c++,c===f)return n(q),q.length?w({errors:q,fields:V(q)}):p()};r.length||(n(q),p()),r.forEach(O=>{const o=e[O];s.indexOf(O)!==-1?J(o,i,A):Y(o,i,A)})});return m.catch(p=>p),m}function L(e){return function(t){return t&&t.message?(t.field=t.field||e.fullField,t):{message:typeof t=="function"?t():t,field:t.field||e.fullField}}}function U(e,t){if(t){for(const i in t)if(t.hasOwnProperty(i)){const n=t[i];typeof n=="object"&&typeof e[i]=="object"?e[i]={...e[i],...n}:e[i]=n}}return e}function Z(e,t,i,n,s,r){e.required&&(!i.hasOwnProperty(e.field)||h(t,r||e.type))&&n.push(l(s.messages.required,e.fullField))}function H(e,t,i,n,s){(/^\s+$/.test(t)||t==="")&&n.push(l(s.messages.whitespace,e.fullField))}const R={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,url:new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i};var B={integer:function(t){return/^(-)?\d+$/.test(t)},float:function(t){return/^(-)?\d+(\.\d+)?$/.test(t)},array:function(t){return Array.isArray(t)},regexp:function(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch{return!1}},date:function(t){return typeof t.getTime=="function"&&typeof t.getMonth=="function"&&typeof t.getYear=="function"},number:function(t){return isNaN(t)?!1:typeof+t=="number"},object:function(t){return typeof t=="object"&&!B.array(t)},method:function(t){return typeof t=="function"},email:function(t){return typeof t=="string"&&!!t.match(R.email)&&t.length<255},url:function(t){return typeof t=="string"&&!!t.match(R.url)},hex:function(t){return typeof t=="string"&&!!t.match(R.hex)}};function Q(e,t,i,n,s){if(e.required&&t===void 0){Z(e,t,i,n,s);return}const r=["integer","float","array","regexp","object","method","email","number","date","url","hex"],f=e.type;r.indexOf(f)>-1?B[f](t)||n.push(l(s.messages.types[f],e.fullField,e.type)):f&&typeof t!==e.type&&n.push(l(s.messages.types[f],e.fullField,e.type))}function X(e,t,i,n,s){const r=typeof e.len=="number",f=typeof e.min=="number",c=typeof e.max=="number",q=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;let m=t,p=null;const w=typeof t=="number",A=typeof t=="string",O=Array.isArray(t);if(w?p="number":A?p="string":O&&(p="array"),!p)return!1;O&&(m=t.length),A&&(m=t.replace(q,"_").length),r?m!==e.len&&n.push(l(s.messages[p].len,e.fullField,e.len)):f&&!c&&m<e.min?n.push(l(s.messages[p].min,e.fullField,e.min)):c&&!f&&m>e.max?n.push(l(s.messages[p].max,e.fullField,e.max)):f&&c&&(m<e.min||m>e.max)&&n.push(l(s.messages[p].range,e.fullField,e.min,e.max))}const S="enum";function I(e,t,i,n,s){e[S]=Array.isArray(e[S])?e[S]:[],e[S].indexOf(t)===-1&&n.push(l(s.messages[S],e.fullField,e[S].join(", ")))}function k(e,t,i,n,s){e.pattern&&(e.pattern instanceof RegExp?(e.pattern.lastIndex=0,e.pattern.test(t)||n.push(l(s.messages.pattern.mismatch,e.fullField,t,e.pattern))):typeof e.pattern=="string"&&(new RegExp(e.pattern).test(t)||n.push(l(s.messages.pattern.mismatch,e.fullField,t,e.pattern))))}const d={required:Z,whitespace:H,type:Q,range:X,enum:I,pattern:k};function ee(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t,"string")&&!e.required)return i();d.required(e,t,n,r,s,"string"),h(t,"string")||(d.type(e,t,n,r,s),d.range(e,t,n,r,s),d.pattern(e,t,n,r,s),e.whitespace===!0&&d.whitespace(e,t,n,r,s))}i(r)}function te(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s),t!==void 0&&d.type(e,t,n,r,s)}i(r)}function ne(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(t===""&&(t=void 0),h(t)&&!e.required)return i();d.required(e,t,n,r,s),t!==void 0&&(d.type(e,t,n,r,s),d.range(e,t,n,r,s))}i(r)}function ie(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s),t!==void 0&&d.type(e,t,n,r,s)}i(r)}function re(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s),h(t)||d.type(e,t,n,r,s)}i(r)}function se(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s),t!==void 0&&(d.type(e,t,n,r,s),d.range(e,t,n,r,s))}i(r)}function fe(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s),t!==void 0&&(d.type(e,t,n,r,s),d.range(e,t,n,r,s))}i(r)}function ae(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t,"array")&&!e.required)return i();d.required(e,t,n,r,s,"array"),h(t,"array")||(d.type(e,t,n,r,s),d.range(e,t,n,r,s))}i(r)}function oe(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s),t!==void 0&&d.type(e,t,n,r,s)}i(r)}const de="enum";function ce(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s),t!==void 0&&d[de](e,t,n,r,s)}i(r)}function pe(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t,"string")&&!e.required)return i();d.required(e,t,n,r,s),h(t,"string")||d.pattern(e,t,n,r,s)}i(r)}function ye(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();if(d.required(e,t,n,r,s),!h(t)){let c;typeof t=="number"?c=new Date(t):c=t,d.type(e,c,n,r,s),c&&d.range(e,c.getTime(),n,r,s)}}i(r)}function he(e,t,i,n,s){const r=[],f=Array.isArray(t)?"array":typeof t;d.required(e,t,n,r,s,f),i(r)}function T(e,t,i,n,s){const r=e.type,f=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t,r)&&!e.required)return i();d.required(e,t,n,f,s,r),h(t,r)||d.type(e,t,n,f,s)}i(f)}function ge(e,t,i,n,s){const r=[];if(e.required||!e.required&&n.hasOwnProperty(e.field)){if(h(t)&&!e.required)return i();d.required(e,t,n,r,s)}i(r)}const M={string:ee,method:te,number:ne,boolean:ie,regexp:re,integer:se,float:fe,array:ae,object:oe,enum:ce,pattern:pe,date:ye,url:T,hex:T,email:T,required:he,any:ge};function D(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){const t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}}}const _=D();function $(e){this.rules=null,this._messages=_,this.define(e)}$.prototype={messages:function(t){return t&&(this._messages=U(D(),t)),this._messages},define:function(t){if(!t)throw new Error("Cannot configure a schema with no rules");if(typeof t!="object"||Array.isArray(t))throw new Error("Rules must be an object");this.rules={};let i,n;for(i in t)t.hasOwnProperty(i)&&(n=t[i],this.rules[i]=Array.isArray(n)?n:[n])},validate:function(t,i,n){const s=this;i===void 0&&(i={}),n===void 0&&(n=function(){});let r=t,f=i,c=n;if(typeof f=="function"&&(c=f,f={}),!this.rules||Object.keys(this.rules).length===0)return c&&c(),Promise.resolve();function q(o){let b,a=[],P={};function N(x){if(Array.isArray(x)){let g;a=(g=a).concat.apply(g,x)}else a.push(x)}for(b=0;b<o.length;b++)N(o[b]);a.length?P=V(a):(a=null,P=null),c(a,P)}if(f.messages){let o=this.messages();o===_&&(o=D()),U(o,f.messages),f.messages=o}else f.messages=this.messages();let m,p;const w={};(f.keys||Object.keys(this.rules)).forEach(o=>{m=s.rules[o],p=r[o],m.forEach(b=>{let a=b;typeof a.transform=="function"&&(r===t&&(r={...r}),p=r[o]=a.transform(p)),typeof a=="function"?a={validator:a}:a={...a},a.validator=s.getValidationMethod(a),a.field=o,a.fullField=a.fullField||o,a.type=s.getType(a),a.validator&&(w[o]=w[o]||[],w[o].push({rule:a,value:p,source:r,field:o}))})});const O={};return G(w,f,(o,b)=>{const{rule:a}=o;let P=(a.type==="object"||a.type==="array")&&(typeof a.fields=="object"||typeof a.defaultField=="object");P=P&&(a.required||!a.required&&o.value),a.field=o.field;function N(j,y){return{...y,fullField:`${a.fullField}.${j}`}}function x(j){j===void 0&&(j=[]);let y=j;if(Array.isArray(y)||(y=[y]),!f.suppressWarning&&y.length&&$.warning("async-validator:",y),y.length&&a.message&&(y=[].concat(a.message)),y=y.map(L(a)),f.first&&y.length)return O[a.field]=1,b(y);if(!P)b(y);else{if(a.required&&!o.value)return a.message?y=[].concat(a.message).map(L(a)):f.error?y=[f.error(a,l(f.messages.required,a.field))]:y=[],b(y);let F={};if(a.defaultField)for(const u in o.value)o.value.hasOwnProperty(u)&&(F[u]=a.defaultField);F={...F,...o.rule.fields};for(const u in F)if(F.hasOwnProperty(u)){const E=Array.isArray(F[u])?F[u]:[F[u]];F[u]=E.map(N.bind(null,u))}const C=new $(F);C.messages(f.messages),o.rule.options&&(o.rule.options.messages=f.messages,o.rule.options.error=f.error),C.validate(o.value,o.rule.options||f,u=>{const E=[];y&&y.length&&E.push.apply(E,y),u&&u.length&&E.push.apply(E,u),b(E.length?E:null)})}}let g;a.asyncValidator?g=a.asyncValidator(a,o.value,x,o.source,f):a.validator&&(g=a.validator(a,o.value,x,o.source,f),g===!0?x():g===!1?x(a.message||`${a.field} fails`):g instanceof Array?x(g):g instanceof Error&&x(g.message)),g&&g.then&&g.then(()=>x(),j=>x(j))},o=>{q(o)})},getType:function(t){if(t.type===void 0&&t.pattern instanceof RegExp&&(t.type="pattern"),typeof t.validator!="function"&&t.type&&!M.hasOwnProperty(t.type))throw new Error(l("Unknown rule type %s",t.type));return t.type||"string"},getValidationMethod:function(t){if(typeof t.validator=="function")return t.validator;const i=Object.keys(t),n=i.indexOf("message");return n!==-1&&i.splice(n,1),i.length===1&&i[0]==="required"?M.required:M[this.getType(t)]||!1}};$.register=function(t,i){if(typeof i!="function")throw new Error("Cannot register a validator by type, validator is not a function");M[t]=i};$.warning=v;$.messages=_;exports.Schema=$;
