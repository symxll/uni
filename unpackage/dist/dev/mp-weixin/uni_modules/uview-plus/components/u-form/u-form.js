"use strict";const w=require("./props.js"),x=require("../../libs/mixin/mpMixin.js"),v=require("../../libs/mixin/mixin.js"),d=require("../../libs/util/async-validator.js"),o=require("../../libs/function/index.js"),R=require("../../libs/function/test.js"),M=require("../../../../common/vendor.js");d.Schema.warning=function(){};const q={name:"u-form",mixins:[x.mpMixin,v.mixin,w.props],provide(){return{uForm:this}},data(){return{formRules:{},validator:{},originalModel:null}},watch:{rules:{immediate:!0,handler(e){this.setRules(e)}},propsChange(e){var t;(t=this.children)!=null&&t.length&&this.children.map(s=>{typeof s.updateParentData=="function"&&s.updateParentData()})},model:{immediate:!0,handler(e){this.originalModel||(this.originalModel=o.deepClone(e))}}},computed:{propsChange(){return[this.errorType,this.borderBottom,this.labelPosition,this.labelWidth,this.labelAlign,this.labelStyle]}},created(){this.children=[]},methods:{setRules(e){if(Object.keys(e).length!==0){if(Object.keys(this.model).length===0){o.error("设置rules，model必须设置！如果已经设置，请刷新页面。");return}this.formRules=e,this.validator=new d.Schema(e)}},resetFields(){this.resetModel()},resetModel(e){this.children.map(t=>{const s=t==null?void 0:t.prop,r=o.getProperty(this.originalModel,s);o.setProperty(this.model,s,r)})},clearValidate(e){e=[].concat(e),this.children.map(t=>{(e[0]===void 0||e.includes(t.prop))&&(t.message=null)})},async validateField(e,t,s=null){this.$nextTick(()=>{const r=[];e=[].concat(e);let n=this.children.map(i=>new Promise((l,j)=>{const h=[];if(e.includes(i.prop)){const y=o.getProperty(this.model,i.prop),_=i.prop.split("."),f=_[_.length-1];let a=[];if(i.itemRules&&i.itemRules.length>0?a=i.itemRules:a=this.formRules[i.prop],!a){l();return}const u=[].concat(a);u.length||l();for(let c=0;c<u.length;c++){const m=u[c],P=[].concat(m==null?void 0:m.trigger);if(s&&!P.includes(s)){l();continue}new d.Schema({[f]:m}).validate({[f]:y},(p,F)=>{var g;R.test.array(p)&&(p.forEach(b=>{b.prop=i.prop}),r.push(...p),h.push(...p)),i.message=(g=h[0])!=null&&g.message?h[0].message:null,c==u.length-1&&l(r)})}}else l({})}));Promise.all(n).then(i=>{typeof t=="function"&&t(r)}).catch(i=>{console.error("An error occurred:",i)})})},validate(e){if(Object.keys(this.formRules).length===0){o.error("未设置rules，请看文档说明！如果已经设置，请刷新页面。");return}return new Promise((t,s)=>{this.$nextTick(()=>{const r=this.children.map(n=>n.prop);this.validateField(r,n=>{n.length?(this.errorType==="toast"&&o.toast(n[0].message),s(n)):t(!0)})})})}}};function C(e,t,s,r,n,i){return{}}const $=M._export_sfc(q,[["render",C]]);wx.createComponent($);
